#! /bin/sh
# (c) Copyright 2019-2022, James Stevens ... see LICENSE for details
# Alternative license arrangements are possible, contact me for more information

session="${1}"
provider="${2}"
workers=3
facility="local0"
loglevel="info"

ses="$(jq .${provider}.sessions < ${BASE}/etc/providers.json)"
if test "${ses}"; then workers="${ses}"; fi

export PYRAR_PROVIDER="${provider}"

cd ${BASE}/python/epp
exec gunicorn \
        --workers ${workers} \
        --log-syslog \
        --log-syslog-to udp://127.0.0.1:514 \
        --log-syslog-facility ${facility} \
        --log-level ${loglevel} \
        --bind unix:/run/epp/wsgi_epprest_${provider}_${session}.sock \
        wsgi_epprest >/tmp/start_wsgi.${provider}_${session}.log 2>&1
